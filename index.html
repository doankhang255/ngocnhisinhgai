<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Thi·ªáp t√¨nh y√™u üíå</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;600&family=Nunito:wght@400;600&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">
<style>
:root{
  --brand:#e94e77;
  --ink:#1f2937;
  --muted:#6b7280;
  --paper:#FFF8F9;
  --cover:#FFF0F5;
  --bg:#FFFFFF1A;
  --card-w: 500px;   /* chi·ªÅu r·ªông m·ª•c ti√™u (preset V·ª™A) */
  --card-ratio: 5/6; /* t·ªâ l·ªá r·ªông:cao c·ªßa thi·ªáp */
}

*{box-sizing:border-box}
body{
  margin:0; overflow:hidden;
  min-height:100vh;
  background:var(--bg);
  font-family:"Nunito","Segoe UI",system-ui,sans-serif;
  display:flex; justify-content:center; align-items:center;
}

/* tr√°i tim ƒë·ªông */
#pinkboard{
  position:absolute;
  top:50%; 
  left:50%;
  width:min(90vw, 600px);
  height:min(90vw, 600px);
  transform:translate(-50%,-50%);
  animation:beat 1.5s ease infinite;
  cursor:pointer;
  z-index:2;
}

@keyframes beat{
  0%,100%{transform:translate(-50%,-50%) scale(1);}
  30%{transform:translate(-50%,-50%) scale(.9);}
}

/* ch·ªØ ‚ÄúM·ªû ƒêI‚Äù tr√™n tim */
#openText {
  position: absolute;
  top: 48%; left: 50%;
  transform: translate(-50%, -50%);
  font-family: "Dancing Script", cursive;
  font-size: 20px;
  font-weight: 800;
  color: #ffb6c1;
  text-shadow: 0 0 14px rgba(255, 105, 180, 0.6);
  cursor: pointer;
  z-index: 3;
  letter-spacing: 1px;
}

/* Thi·ªáp (·∫©n l√∫c ƒë·∫ßu) */
.hidden{display:none;}
.stage{perspective:1600px;}
/* Card responsive: vu√¥ng, co theo m√†n h√¨nh, kh√¥ng tr√†n */
.card{
  position: relative;
  width: min(560px, 96vw);   /* nh∆∞ b·∫£n ƒë·∫ßu */
  aspect-ratio: 1 / 1;       /* lu√¥n vu√¥ng */
  max-height: min(88vh, 680px); /* kh√¥ng v∆∞·ª£t qu√° chi·ªÅu cao m√†n h√¨nh */
  height: auto;
  background: var(--paper);
  border-radius: 18px;
  box-shadow: 0 28px 70px rgba(0,0,0,.18);
  border: 1px solid rgba(0,0,0,.06);
  overflow: hidden;
}
.inner{
  position:absolute; inset:0; display:grid; grid-template-columns:1fr 1fr;
}
.page{padding:28px 26px;}
.left{
  background:radial-gradient(900px 260px at -10% 0%, rgba(233,78,119,.08), transparent 60%), var(--paper);
}
.right{
  background:radial-gradient(900px 260px at 110% 0%, rgba(233,78,119,.08), transparent 60%), var(--paper);
}
.ribbon{display:inline-block;padding:6px 12px;border-radius:999px;background:rgba(233,78,119,.12);color:var(--brand);font-weight:800;letter-spacing:.3px;font-size:12px;}
h1{font-size:36px;line-height:1.15;margin:12px 0 8px}
.lead{color:var(--muted);font-size:18px;margin:0 0 12px}
.section-title{text-transform:uppercase;font-size:12px;letter-spacing:.5px;color:var(--muted);margin:14px 0 6px}
.big{font-size:22px;font-weight:800;line-height:1.35;}
.note{color:var(--muted);margin-top:6px}

/* b√¨a thi·ªáp */
.cover{
  position:absolute;top:0;bottom:0;right:0;width:50%;
  transform-origin:left center;
  transform-style:preserve-3d;
  transition:transform .9s cubic-bezier(.2,.7,.2,1);
  background:var(--cover);
  border-left:1px solid rgba(0,0,0,.06);
  will-change: transform;
}
.cover-outer,.cover-inner{
  position:absolute;inset:0;backface-visibility:hidden;
  display:flex;flex-direction:column;justify-content:center;align-items:center;
  text-align:center;padding:32px;
}
.cover-outer{
  background:radial-gradient(1200px 300px at 50% -10%, rgba(233,78,119,.12), transparent 60%), var(--cover);
}
.cover-inner{transform:rotateY(180deg);background:#fff7fa;}
.card.open .cover{transform:rotateY(-180deg);}
.hint{text-align:center;margin-top:12px;color:var(--muted);font-size:14px}

/* ================= PIN keypad (custom) ================= */
.pin-box{
  margin-top:16px;background:#fff;border:1px solid rgba(0,0,0,.08);
  border-radius:16px;padding:18px;text-align:center;user-select:none;
  transition: box-shadow .25s ease, border-color .25s ease;
}
.pin-box.success{ box-shadow:0 0 0 4px rgba(16,185,129,.2); border-color:#10b981; }
.pin-box.error{ animation: pin-shake .4s; border-color:#ef4444; }
@keyframes pin-shake{
  10%, 90% { transform: translateX(-1px); }
  20%, 80% { transform: translateX(2px); }
  30%, 50%, 70% { transform: translateX(-4px); }
  40%, 60% { transform: translateX(4px); }
}

.pin-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
.pin-title{ font-weight:700; color:#e94e77; letter-spacing:.3px; }
.pin-eye{
  border:none; background:transparent; cursor:pointer; font-size:18px; line-height:1;
  opacity:.7; transition:opacity .2s ease, transform .1s ease;
}
.pin-eye:hover{ opacity:1; }
.pin-eye:active{ transform:scale(.96); }

.pin-visual{ display:flex; justify-content:center; gap:12px; margin:10px 0 14px; }
.pin-digit{
  width:40px; height:50px; border-radius:12px;
  border:2px solid rgba(0,0,0,.15);
  display:flex; align-items:center; justify-content:center;
  font-weight:800; font-size:20px; color:#1f2937;
  transition:border-color .2s ease, transform .08s ease;
}
.pin-digit.filled{ border-color:#e94e77; }
.pin-digit.flash{ transform:scale(1.08); }
.pin-digit .dot{ width:10px; height:10px; border-radius:50%; background:#1f2937; }

.pin-progress{ height:6px; background:#f3f4f6; border-radius:999px; overflow:hidden; margin:0 14% 10px; }
.pin-progress-bar{ height:100%; width:0%; background:#e94e77; transition: width .2s ease; }

.keypad{ display:grid; grid-template-columns:repeat(3, 1fr); gap:10px; max-width:280px; margin:0 auto; }
.key{
  padding:12px 0; font-size:18px; font-weight:700; background:#fff;
  border:1px solid rgba(0,0,0,.1); border-radius:12px; cursor:pointer;
  transition:transform .05s ease, background .15s ease, box-shadow .15s ease;
  box-shadow:0 2px 0 rgba(0,0,0,.05);
}
.key:hover{ background:#fff7fa; }
.key:active{ transform:translateY(1px); }
.key.accent{ background:var(--brand); color:#fff; border-color:transparent; }
.key.icon{ font-weight:600; }

.msg{margin-top:10px;color:var(--muted);font-size:13px;min-height:18px}
.small-hint{margin-top:10px;color:#9ca3af;font-size:12px}
.pin-hidden-input{ position:absolute; opacity:0; pointer-events:none; width:0; height:0; }

/* Mobile tweaks */
/* Mobile fix: hi·ªÉn th·ªã ƒë·ªß thi·ªáp, kh√¥ng b·ªã khu·∫•t */
@media (max-width: 640px){
  /* Cho ph√©p cu·ªôn d·ªçc + ch·ª´a v√πng notch */
  html, body { height: auto; overflow-y: auto; }
  body {
    padding-top: max(10px, env(safe-area-inset-top));
    padding-bottom: 16px;
  }

  /* Thu nh·ªè tr√°i tim ƒë·ªÉ kh√¥ng ƒë√® n·ªôi dung (gi·ªØ nguy√™n n·∫øu c√¥ th√≠ch) */
  #pinkboard{
    width: min(70vw, 360px);
    height: min(70vw, 360px);
  }

  /* Card gi·ªØ t·ªâ l·ªá vu√¥ng nh∆∞ b·∫£n ƒë·∫ßu, ch·ªâ thu nh·ªè theo m√†n h√¨nh */
  .card{
    width: 94vw;
    max-height: 86vh;
    aspect-ratio: 1 / 1;   /* KH√îNG ƒë·ªÉ auto n·ªØa */
    height: auto;
    margin: 10px auto 20px;
  }

  /* C√°c ph·∫ßn mobile kh√°c c·ªßa c√¥ gi·ªØ nguy√™n */
}
</style>
</head>
<body>

<!-- Tr√°i tim ƒë·ªông -->
<canvas id="pinkboard"></canvas>
<div id="openText">ch·∫°m v√¥ ƒë√¢y ·ª£ üíå</div>

<!-- Thi·ªáp (·∫©n) -->
<div class="stage hidden" id="inviteStage">
  <div class="card" id="card">
    <div class="inner">
      <div class="page left">
        <span class="ribbon">THI·ªÜP T·ªàNH C·ª¶M</span>
        <h2 class = "big">G·ª≠i ƒë·∫øn em</h2>
        <p class="lead">ch·ª©c m·ª´ng 2 th√°ng m√¨nh b√™n nhau ·ª£ - v√† 20-10 h·∫π h·∫π ‚ù§Ô∏è</p>

        <!-- H·ªôp PIN custom -->
        <div class="pin-box pin-theme" aria-label="Nh·∫≠p m√£ PIN">
          <div class="pin-header">
            <div class="pin-title">NH√ç IU</div>
            <button class="pin-eye" id="toggleMask" aria-label="Hi·ªán/·∫©n s·ªë" title="Hi·ªán/·∫©n s·ªë"></button>
          </div>

          <!-- ch·∫•m/digit (t·ª± sinh theo ƒë·ªô d√†i PIN) -->
          <div class="pin-visual" id="pinDots" aria-live="polite"></div>

          <!-- ti·∫øn ƒë·ªô -->
          <div class="pin-progress">
            <div class="pin-progress-bar" id="pinProg"></div>
          </div>

          <!-- keypad -->
          <div class="keypad" id="keypad" role="group" aria-label="B√†n ph√≠m s·ªë">
            <button class="key" data-key="1">1</button>
            <button class="key" data-key="2">2</button>
            <button class="key" data-key="3">3</button>
            <button class="key" data-key="4">4</button>
            <button class="key" data-key="5">5</button>
            <button class="key" data-key="6">6</button>
            <button class="key" data-key="7">7</button>
            <button class="key" data-key="8">8</button>
            <button class="key" data-key="9">9</button>
            <button class="key icon" data-action="clear" title="Xo√°">‚å´</button>
            <button class="key" data-key="0">0</button>
            <button class="key icon accent" data-action="ok" title="X√°c nh·∫≠n">OK</button>
          </div>

          <div class="msg" id="msg" aria-live="polite">G·ª£i √Ω: m√£ 4 s·ªë ‚ô•</div>
          <input id="hiddenPinInput" inputmode="numeric" pattern="[0-9]*" autocomplete="one-time-code" class="pin-hidden-input" />
        </div>
      </div>

      <div class="page right">
        <div class="section-title">L·ªùi nh·∫Øn</div>
        <div class="big">
          ‚ÄúC·∫£m ∆°n em ƒë√£ lu√¥n b√™n anh.<br>Ch√∫c em ng√†y m·ªõi th·∫≠t vui v·∫ª v√† tr√†n ƒë·∫ßy y√™u th∆∞∆°ng.‚Äù
        </div>
        <p class="note" contenteditable="true">T·ª´ anh, ng∆∞·ªùi lu√¥n th∆∞∆°ng em ‚ô•</p>
      </div>
    </div>

    <div class="cover" id="cover">
      <div class="cover-outer">
        <h2>Thi·ªáp g·ª≠i ri√™ng cho em</h2>
        <p class="lead">Ch·∫°m ƒë·ªÉ m·ªü</p>
      </div>
      <div class="cover-inner">
        <p class="lead">‚ô• Anh r·∫•t vui v√¨ em ƒë√£ m·ªü thi·ªáp ‚ô•</p>
      </div>
    </div>
  </div>
</div>

<script>
/* ------------------ LOGIC M·ªû THI·ªÜP ------------------- */
const openText = document.getElementById('openText');
const canvasHeart = document.getElementById('pinkboard');
const stage = document.getElementById('inviteStage');
const card = document.getElementById('card');
openText.addEventListener('click', ()=>{
  canvasHeart.style.display='none';
  openText.style.display='none';
  stage.classList.remove('hidden');
});

/* ------------------ PIN KEYPAD (custom) ------------------- */
const PIN = "0812";               // ƒë·ªïi m√£ t·∫°i ƒë√¢y
const maskDuration = 700;         // ms: hi·ªán s·ªë th·∫≠t 0.7s r·ªìi che l·∫°i (khi ƒëang ·∫©n)

const msg = document.getElementById('msg');
const pinDots = document.getElementById('pinDots');
const pinProg = document.getElementById('pinProg');
const keypad = document.getElementById('keypad');
const pinBox = document.querySelector('.pin-box');
const toggleMaskBtn = document.getElementById('toggleMask');
const hiddenInput = document.getElementById('hiddenPinInput');

let buffer = "";
let showPlain = false;
let lastFlashTimer = null;

function buildDigits(){
  pinDots.innerHTML = "";
  for(let i=0;i<PIN.length;i++){
    const d = document.createElement('div');
    d.className = 'pin-digit';
    d.dataset.index = i;
    pinDots.appendChild(d);
  }
  updateVisual();
}
buildDigits();

function updateVisual(){
  const pct = Math.min(100, Math.round(buffer.length / PIN.length * 100));
  pinProg.style.width = pct + "%";

  const digits = [...pinDots.children];
  digits.forEach((el, i)=>{
    el.classList.toggle('filled', i < buffer.length);
    el.innerHTML = '';
    if(i < buffer.length){
      if(showPlain){ el.textContent = buffer[i]; }
      else{
        const dot = document.createElement('div');
        dot.className = 'dot';
        el.appendChild(dot);
      }
    }
  });
}

function flashLast(){
  if(!pinDots.children.length) return;
  const idx = buffer.length - 1;
  if(idx < 0) return;
  const el = pinDots.children[idx];
  el.classList.add('flash');
  clearTimeout(lastFlashTimer);
  lastFlashTimer = setTimeout(()=>el.classList.remove('flash'), 120);
}

function shakeError(){
  pinBox.classList.remove('success');
  pinBox.classList.add('error');
  setTimeout(()=>pinBox.classList.remove('error'), 450);
}
function successPulse(){
  pinBox.classList.add('success');
  setTimeout(()=>pinBox.classList.remove('success'), 1200);
}

function tryUnlock(){
  if(buffer.length !== PIN.length){
    msg.textContent = `Nh·∫≠p ƒë·ªß ${PIN.length} s·ªë nh√©!`;
    msg.style.color = "#b45309";
    shakeError();
    return;
  }
  if(buffer === PIN){
    msg.textContent = "‚úî M·∫≠t kh·∫©u ƒë√∫ng! Thi·ªáp ƒëang m·ªü...";
    msg.style.color = "green";
    successPulse();
    card.classList.add('open');
  }else{
    msg.textContent = "‚ùå Sai m√£ r·ªìi, th·ª≠ l·∫°i nh√©!";
    msg.style.color = "red";
    buffer = "";
    updateVisual();
    shakeError();
  }
}

function pushDigit(d){
  if(!/^\d$/.test(d)) return;
  if(buffer.length >= PIN.length) return;
  buffer += d;
  updateVisual();
  flashLast();

  if(!showPlain){
    const idx = buffer.length - 1;
    const el = pinDots.children[idx];
    el.textContent = d;
    setTimeout(()=>{
      if(buffer.length > idx && !showPlain){
        el.innerHTML = '<div class="dot"></div>';
      }
    }, maskDuration);
  }
}
function popDigit(){ buffer = buffer.slice(0,-1); updateVisual(); }
function clearAll(){
  buffer = "";
  updateVisual();
  msg.textContent = "ƒê√£ xo√°, nh·∫≠p l·∫°i nh√©.";
  msg.style.color = "#6b7280";
}

let clearHoldTimer = null;
keypad.addEventListener('mousedown', (e)=>{
  const btn = e.target.closest('.key[data-action="clear"]');
  if(!btn) return;
  clearHoldTimer = setTimeout(()=>{ clearAll(); }, 500);
});
window.addEventListener('mouseup', ()=>{ clearTimeout(clearHoldTimer); });
keypad.addEventListener('mouseleave', ()=>{ clearTimeout(clearHoldTimer); });

keypad.addEventListener('click', (e)=>{
  const t = e.target.closest('.key');
  if(!t) return;
  const key = t.getAttribute('data-key');
  const action = t.getAttribute('data-action');

  if(key){ pushDigit(key); }
  else if(action === 'clear'){ popDigit(); }
  else if(action === 'ok'){ tryUnlock(); }
});

window.addEventListener('keydown', (e)=>{
  if(/^\d$/.test(e.key)) pushDigit(e.key);
  else if(e.key === 'Backspace') popDigit();
  else if(e.key === 'Enter') tryUnlock();
});

hiddenInput.addEventListener('input', ()=>{
  const val = (hiddenInput.value || "").replace(/\D/g,'');
  if(!val) return;
  for(const ch of val){ pushDigit(ch); }
  hiddenInput.value = "";
});
pinBox.addEventListener('click', ()=> hiddenInput.focus());

toggleMaskBtn.addEventListener('click', ()=>{
  showPlain = !showPlain;
  updateVisual();
});

/* ------------------ HI·ªÜU ·ª®NG TR√ÅI TIM ------------------- */
var settings = {
  particles:{length:700,duration:1.5,velocity:100,effect:-0.85,size:24}
};
(function(){
  var Point=function(x,y){this.x=x||0;this.y=y||0};
  Point.prototype.clone=function(){return new Point(this.x,this.y)};
  Point.prototype.length=function(len){
    if(len===undefined)return Math.sqrt(this.x*this.x+this.y*this.y);
    this.normalize();this.x*=len;this.y*=len;return this;
  };
  Point.prototype.normalize=function(){
    var l=this.length();this.x/=l;this.y/=l;return this;
  };
  var Particle=function(){
    this.position=new Point();this.velocity=new Point();this.acceleration=new Point();this.age=0;
  };
  Particle.prototype.initialize=function(x,y,dx,dy){
    this.position.x=x;this.position.y=y;
    this.velocity.x=dx;this.velocity.y=dy;
    this.acceleration.x=dx*settings.particles.effect;
    this.acceleration.y=dy*settings.particles.effect;
    this.age=0;
  };
  Particle.prototype.update=function(d){
    this.position.x+=this.velocity.x*d;
    this.position.y+=this.velocity.y*d;
    this.velocity.x+=this.acceleration.x*d;
    this.velocity.y+=this.acceleration.y*d;
    this.age+=d;
  };
  Particle.prototype.draw=function(ctx,img){
    var ease=t=>--t*t*t+1;
    var size=img.width*ease(this.age/settings.particles.duration);
    ctx.globalAlpha=1-this.age/settings.particles.duration;
    ctx.drawImage(img,this.position.x-size/2,this.position.y-size/2,size,size);
  };
  var ParticlePool=function(l){
    var particles=new Array(l);
    for(let i=0;i<l;i++)particles[i]=new Particle();
    var firstActive=0,firstFree=0,duration=settings.particles.duration;
    this.add=function(x,y,dx,dy){
      particles[firstFree].initialize(x,y,dx,dy);
      firstFree=(firstFree+1)%l;
      if(firstActive===firstFree)firstActive=(firstActive+1)%l;
    };
    this.update=function(dt){
      var i;
      if(firstActive<firstFree){
        for(i=firstActive;i<firstFree;i++)particles[i].update(dt);
      }else{
        for(i=firstActive;i<l;i++)particles[i].update(dt);
        for(i=0;i<firstFree;i++)particles[i].update(dt);
      }
      while(particles[firstActive].age>=duration && firstActive!==firstFree){
        firstActive=(firstActive+1)%l;
      }
    };
    this.draw=function(ctx,img){
      var i;
      if(firstActive<firstFree){
        for(i=firstActive;i<firstFree;i++)particles[i].draw(ctx,img);
      }else{
        for(i=firstActive;i<l;i++)particles[i].draw(ctx,img);
        for(i=0;i<firstFree;i++)particles[i].draw(ctx,img);
      }
    };
  };

  (function(canvas){
    var ctx=canvas.getContext('2d');
    var particles=new ParticlePool(settings.particles.length);
    var particleRate=settings.particles.length/settings.particles.duration;
    var time;

    function pointOnHeart(t){
      return new Point(
        160*Math.pow(Math.sin(t),3),
        130*Math.cos(t)-50*Math.cos(2*t)-20*Math.cos(3*t)-10*Math.cos(4*t)+25
      );
    }

    var image=(function(){
      var c=document.createElement('canvas'),ctx2=c.getContext('2d');
      c.width=settings.particles.size;c.height=settings.particles.size;
      function to(t){
        var p=pointOnHeart(t);
        p.x=settings.particles.size/3+p.x*settings.particles.size/550;
        p.y=settings.particles.size/3-p.y*settings.particles.size/550;
        return p;
      }
      ctx2.beginPath();
      var t=-Math.PI,p=to(t);ctx2.moveTo(p.x,p.y);
      while(t<Math.PI){t+=0.01;p=to(t);ctx2.lineTo(p.x,p.y);}
      ctx2.closePath();ctx2.fillStyle='#FF6F91';  
      ctx2.fill();
      var img=new Image();img.src=c.toDataURL();return img;
    })();

    function render(){
      requestAnimationFrame(render);
      var newTime=new Date().getTime()/1000,dt=newTime-(time||newTime);time=newTime;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      var amount=particleRate*dt;
      for(var i=0;i<amount;i++){
        var pos=pointOnHeart(Math.PI-2*Math.PI*Math.random());
        var dir=pos.clone().length(settings.particles.velocity);
        particles.add(canvas.width/2+pos.x,canvas.height/2-pos.y,dir.x,-dir.y);
      }
      particles.update(dt);
      particles.draw(ctx,image);
    }
    function onResize(){
      canvas.width=canvas.clientWidth;
      canvas.height=canvas.clientHeight;
    }
    window.onresize=onResize;
    setTimeout(function(){onResize();render();},10);
  })(document.getElementById('pinkboard'));
})();
</script>
</body>
</html>
